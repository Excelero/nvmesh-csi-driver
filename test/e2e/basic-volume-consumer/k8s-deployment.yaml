---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: nvmesh-csi-pvc
  namespace: nvmesh-csi
spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 5Gi
  storageClassName: nvmesh-concatenated
---
apiVersion: v1
kind: Pod
metadata:
  name: consumer-pod-1
  namespace: nvmesh-csi
  labels:
    app: nvmesh-csi-testing
spec:
  containers:
  - name: consumer1
    image: basic-volume-consumer:develop
    env:
      - name: WORKER_ID
        value: "consumer1"
    volumeMounts:
      - name: volume-mnt
        mountPath: /mnt/vol/
      - name: device-dir
        mountPath: /dev
  - name: consumer2
    image: basic-volume-consumer:develop
    env:
      - name: WORKER_ID
        value: "consumer2"
    volumeMounts:
      - name: volume-mnt
        mountPath: /mnt/vol/
      - name: device-dir
        mountPath: /dev
  volumes:
    - name: volume-mnt
      persistentVolumeClaim:
        claimName: nvmesh-csi-pvc
    - name: device-dir
      hostPath:
        path: /dev
---
apiVersion: v1
kind: Pod
metadata:
  name: consumer-pod-2
  namespace: nvmesh-csi
  labels:
    app: nvmesh-csi-testing
spec:
  containers:
  - name: consumer3
    image: basic-volume-consumer:develop
    env:
      - name: WORKER_ID
        value: "consumer3"
    volumeMounts:
      - name: volume-mnt
        mountPath: /mnt/vol/
      - name: device-dir
        mountPath: /dev
  volumes:
    - name: volume-mnt
      persistentVolumeClaim:
        claimName: nvmesh-csi-pvc
    - name: device-dir
      hostPath:
        path: /dev