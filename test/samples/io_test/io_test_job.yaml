apiVersion: batch/v1
kind: Job
metadata:
  name: nvmesh-io-test
  labels:
    nvmesh-csi-testing: ""
spec:
  template:
    spec:
      serviceAccountName: nvmesh-cluster
      restartPolicy: Never
      containers:
        - name: filesystem-mount-io-test
          image: registry.excelero.com/dev/io-test:1.0.0
          imagePullPolicy: Always
          command:
            - /opt/iozone/bin/iozone
            - /mnt/vol
            - -a
          volumeMounts:
            - name: fs-volume
              mountPath: /mnt/vol
        - name: block-device-io-test
          image: registry.excelero.com/dev/io-test:1.0.0
          imagePullPolicy: Always
          command:
            - fio
            - --direct=1
            - --rw=randrw
            - --norandommap
            - --randrepeat=0
            - --ioengine=libaio
            - --rwmixread=100
            - --group_reporting
            - --name=testread
            - --time_based
            - --verify=0
            - --iodepth=1
            - --numjobs=1s
            - --size=1G
            - --bs=4k
            - --runtime=$run_time
            - --random_generator=tausworthe64
            - --filename=/dev/my_block_dev
          volumeDevices:
            - name: block-volume
              devicePath: /dev/my_block_dev
      volumes:
      - name: block-volume
        persistentVolumeClaim:
          claimName: block-pvc
      - name: fs-volume
        persistentVolumeClaim:
          claimName: fs-pvc